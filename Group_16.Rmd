---
title: "Project 2"
author: "Group 16"
date: "2022/3/8"
output:
  pdf_document:
    latex_engine: pdflatex
    number_sections: yes
    keep_tex: true
  html_document:
    df_print: paged
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = NA, message = FALSE, warning = FALSE)
```

```{r libraries}
library(tidyverse)
library(ggplot2)
library(skimr)
library(GGally)
library(olsrr)
library(kableExtra)
library(moderndive)
library(lme4)
library(tidyverse)
library(moderndive)
library(gapminder)
library(sjPlot)
library(stats)
library(jtools)
library(janitor)
```

```{r load data}
#data <- read.csv("dataset16.csv")
data<-load("2000data.RData")
```

```{r data summary and drop NAs}
skim(data)
#price column have NAs with complete_rate 0.923, so we can simply drop rows with NAs.
data_without_NAs <- data %>% 
  drop_na() %>% 
  mutate(above90 = ifelse(points > 90, 1, 0))
skim(data_without_NAs)
```

```{r visual summary for numeric}
# data_without_NAs %>% 
#   ggplot(mapping = aes(y = points)) +
#   geom_boxplot()
# 
# data_without_NAs %>% 
#   ggplot(mapping = aes(y = price)) +
#   geom_boxplot()
#Many outliers

# data_without_NAs %>% 
#   ggplot(mapping = aes(x = country, y = points)) +
#   geom_boxplot()
# 
# data_without_NAs %>% 
#   ggplot(mapping = aes(x = country, y = price)) +
#   geom_boxplot()

data_without_NAs %>% 
  ggplot(mapping = aes(x = above90, y = price, group = above90)) +
  geom_boxplot()



```


```{r catigrical data}
data_without_NAs=tidyr::unite(data_without_NAs,'country_p',country,province,remove = FALSE)
data_without_NAs$country <- as.factor(data_without_NAs$country)
data_without_NAs$above90<-as.factor(data_without_NAs$above90)
levels(data_without_NAs$above90) <- c("Low", "High")
data_without_NAs$title <- as.factor(data_without_NAs$title)
data_without_NAs$variety<-as.factor(data_without_NAs$variety)
data_without_NAs$winery<-as.factor(data_without_NAs$winery)
data_without_NAs$country_p<-as.factor(data_without_NAs$country_p)
data_without_NAs$province<-as.factor(data_without_NAs$province)
```

```{r boxplot for country}
ggplot(data = data_without_NAs, aes(x = above90, y = price, fill = above90)) +
geom_boxplot() +
labs(x = "Points", y = "Price") +
theme(legend.position = "none")
```


```{r country points stats}
data_without_NAs %>%
tabyl(country, above90) %>%
adorn_percentages() %>%
adorn_pct_formatting() %>%
adorn_ns() # To show original counts
```



```{r country points graph}
ggplot(data = data_without_NAs, aes(x = above90, group = country)) +
geom_bar(aes(y = ..prop.., fill = country), stat = "count", position = "dodge") +
labs(x = "Points", y = "Proportion")
```


```{r}
view=aggregate(data_without_NAs$country_p, by=list(type=data_without_NAs$country),length)
arrange(view,desc(x))
```
```{r}
US=data_without_NAs[which(data_without_NAs$country=='US'),]
Italy=data_without_NAs[which(data_without_NAs$country=='Italy'),]
France=data_without_NAs[which(data_without_NAs$country=='France'),]
```

```{r}
mod.US_p <- glm(above90 ~ country_p, data = US, family = binomial(link = "logit"))
mod.US_p %>%
summary()

```




```{r}
mod.Italy_p <- glm(above90 ~ country_p, data = Italy, family = binomial(link = "logit"))
mod.Italy_p %>%
summary()

```

```{r}
mod.France_p <- glm(above90 ~ country_p, data = France, family = binomial(link = "logit"))
mod.France_p %>%
summary()

```


```{r US country_p points graph}
ggplot(data = US, aes(x = above90, group = country_p)) +
geom_bar(aes(y = ..prop.., fill = country_p), stat = "count", position = "dodge") +
labs(x = "Points", y = "Proportion")
```
```{r}
US.Low_area=filter(US,country_p=='US_Colorado'|country_p=='US_Idaho'|country_p=='US_Michigan'|country_p=='US_New Mexico'|country_p=='US_Virginia')
US.High_area=filter(US,country_p!='US_Colorado'&country_p!='US_Idaho'&country_p!='US_Michigan'&country_p!='US_New Mexico'&country_p!='US_Virginia')
```


```{r}
mod.US_high_p <- glm(above90 ~ country_p, data = US.High_area, family = binomial(link = "logit"))
mod.US_high_p %>%
summary()

```
```{r}
US.California=filter(US,country_p=='US_California')
US.nonCalifornia=filter(US,country_p!='US_California')
US.California['California']=1
US.nonCalifornia['California']=0
US=bind_rows(US.California,US.nonCalifornia)
```

```{r}
mod.US_Cali <- glm(above90 ~ California, data = US, family = binomial(link = "logit"))
mod.US_Cali %>%
summary()

n
```
```{r}
France%>%
  t=group_by(country_p)%>%
summarize()
=======

* country – Country of origin
* points – The number of points awarded for the wine on a scale of 1-100 (although reviews are only posted for ratings 80 and above)
* price – The cost for a bottle of wine
* province – The province or state the wine is from
* title – The title of the wine review
* variety – The type of grape
* winery – The winery that made the wine


```{r country points graph 2}
# this plot might be easier to view than the plot in the chunk above
ggplot(data_without_NAs, aes(x = country, fill = above90)) +
    geom_bar(position = "fill") +
    theme_classic() +
    theme(axis.text.x = element_text(angle = 90)) +
    labs(x = "Points", y = "Proportion")

```


```{r}
NorthAmerica=filter(data_without_NAs,country=='US'|country=='Canada')
 NorthAmerica=filter(data_without_NAs,country=='US'|country=='Canada')
 NorthAmerica['Area']='NorthAmerica'
 
Italy=filter(data_without_NAs,country=='Italy')
 Italy['Area']='Italy'
 
 France=filter(data_without_NAs,country=='France')
 France['Area']='France'
 
 Spain=filter(data_without_NAs,country=='Spain')
 Spain['Area']='Spain'
 
 SouthAmerica=filter(data_without_NAs,country=='Portugal'|country=='New Zealand'|country=='South Africa'	)
 SouthAmerica['Area']='SouthAmerica'
 
 SouthGlobe=filter(data_without_NAs,country=='Australia'|country=='Chile'|country=='Argentina'	)
 SouthGlobe['Area']='SouthGlobe'
 
 WestEU=filter(data_without_NAs,country=='Austria'|country=='Germany'|country=='England'	)
 WestEU['Area']='WestEU'
 
 India=filter(data_without_NAs,country=='India')
India['Area']='India'
 
 EastEU=filter(data_without_NAs,country=='Greece'|country=='Romania'|country=='Croatia'|country=='Israel'|country=='Bulgaria'|country=='Georgia'|country=='Slovenia'|country=='Turkey'|country=='Uruguay'|country=='Czech Republic'|country=='Hungary')
 EastEU['Area']='EastEU'
 
 data_area=bind_rows(NorthAmerica,Italy,France,Spain,SouthAmerica,SouthGlobe,WestEU,EastEU,India)
```

* country – Categorical, could be influential
* points – Numerical, response, split in to above and below 90 and become binary
* price – Numerical, could be influential
* province – Categorical, could be influential
* title – useless for model
* variety – Categorical, could be influential
* winery – Categorical, could be a little bit influential, since have 1500+ unique value, maybe dropped



```{r deduplication}
data_without_NAs %>% 
  group_by(title) %>% 
  count() %>% 
  arrange(desc(n))
#title Cramele Recas 2014 Legendary Estate Series Cabernet Sauvignon (Romania) appear twice
data_without_NAs %>% 
  filter(title == 'Cramele Recas 2014 Legendary Estate Series Cabernet Sauvignon (Romania)')
#two observation(331 and 1807) with same information, we drop it
data_without_NAs <- data_without_NAs %>%
  filter(X != 1807)
```

```{r}
glm(above90 ~ country + province + price + variety + winery, data = data_without_NAs, family = binomial(link = "logit"))
```

```{r}
model_price <- glm(above90 ~ price, data = data_without_NAs, family = binomial(link = "logit"))
summary(model_price)
```


```{r}
model_price_country <- glm(above90 ~ price + country, data = data_without_NAs, family = binomial(link = "logit"))
summary(model_price_country)
```

```{r explore country distribution}
data_without_NAs %>% 
  group_by(country) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))
```

```{r explore province distribution}
data_without_NAs %>% 
  group_by(province) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))
```

```{r explore country-province distribution}
data_without_NAs %>% 
  group_by(country, province) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))
```


```{r winery}
data_without_NAs %>% 
  group_by(winery) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))

data_without_NAs %>% 
  group_by(winery) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count)) %>% 
  group_by(count) %>% 
  summarize(sumcount = sum(count), High = sum(High), Low = sum(Low))
```
```{r processed_winery}
data_without_NAs %>% 
  group_by(winery) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count)) %>% 
  mutate(processed_winery = if_else(count == 1, "small winerys", "large winerys")) %>% 
  # as.character(winery)
  group_by(processed_winery) %>% 
  summarize(count = sum(count), High = sum(High), Low = sum(Low)) %>% 
  arrange(desc(count)) 
```



```{r}
data_without_NAs %>% 
  group_by(variety) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))

data_without_NAs %>% 
  group_by(variety) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count)) %>% 
  group_by(count) %>% 
  summarize(sumcount = sum(count), High = sum(High), Low = sum(Low))
```

```{r}
data_without_NAs %>% 
  group_by(variety) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))

data_without_NAs %>% 
  group_by(variety) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count)) %>% 
  group_by(count) %>% 
  summarize(sumcount = sum(count), High = sum(High), Low = sum(Low))

data_without_NAs %>% 
  group_by(variety) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count)) %>% 
  group_by(count) %>% 
  summarize(sumcount = sum(count), High = sum(High), Low = sum(Low)) %>% 
  group_by(count) %>% 


```{r}
data_area%>%
   group_by(Area)%>% summarize(count=n(),sumhigh=sum(above90=='High'),sumlow=sum(above90=='Low'))%>%
   arrange(desc(count))
```
=======
```


```{r}
NorthAmerica=filter(data_without_NAs,country=='US'|country=='Canada')
NorthAmerica['Area']='NorthAmerica'


Italy=filter(data_without_NAs,country=='Italy')
Italy['Area']='Italy'


```{r}
   
 mod.area <- glm(above90 ~ 0+Area, data = data_area, family = binomial(link = "logit"))
 mod.area %>%
 summary()
```
=======
France=filter(data_without_NAs,country=='France')
France['Area']='France'


Spain=filter(data_without_NAs,country=='Spain')
Spain['Area']='Spain'


```{r}
ggplot(data = data_area, aes(x = above90, group = Area)) +
 geom_bar(aes(y = ..prop.., fill = Area), stat = "count", position = "dodge") +
 labs(x = "Points", y = "Proportion")
 data2=bind_rows(NorthAmerica,Italy)
```

```{r}
data_area%>%
   group_by(Area)%>%
 summarize(count=n(),sumhigh=sum(above90=='High'),sumlow=sum(above90=='Low'))%>%
  arrange(desc(count))
```

```{r}
mod.area <- glm(above90 ~ 0+Area, data = data2, family = binomial(link = "logit"))
 mod.area %>%
 summary()
```
=======
SouthAmerica=filter(data_without_NAs,country=='Portugal'|country=='New Zealand'|country=='South Africa'	)
SouthAmerica['Area']='SouthAmerica'

SouthGlobe=filter(data_without_NAs,country=='Australia'|country=='Chile'|country=='Argentina'	)
SouthGlobe['Area']='SouthGloble'


WestEU=filter(data_without_NAs,country=='Austria'|country=='Germany'|country=='England'	)
WestEU['Area']='WestEU'

India=filter(data_without_NAs,country=='India')
India['Area']='India'

EastEU=filter(data_without_NAs,country=='Greece'|country=='Romania'|country=='Croatia'|country=='Israel'|country=='Bulgaria'|country=='Georgia'|country=='Slovenia'|country=='Turkey'|country=='Uruguay'|country=='Czech Republic'|country=='Hungary')
EastEU['Area']='EastEU'


```{r}
data_without_NAs%>%
   group_by(country)%>%
 summarize(count=n())
 data_without_NAs%>%
   group_by(country,variety)%>%
summarize(count=n())
=======
data_area=bind_rows(NorthAmerica,Italy,France,Spain,SouthAmerica,SouthGlobe,WestEU,EastEU,India)

```

```{r}


data_without_NAs%>%
   
   group_by(variety)%>%
summarize(count=n(),sumhigh=sum(above90=='High'),sumlow=sum(above90=='Low'))%>%
arrange(desc(count))
=======
```{r}
data_area %>%
  group_by(Area) %>% 
  summarize(count = n(), High = sum(above90 == 'High'), Low = sum(above90 == 'Low')) %>% 
  arrange(desc(count))
```
```{r}
summary(glm(above90 ~ 0 + Area, data = data_area, family = binomial(link = "logit")))
```


```
```{r}
Pinot_Noir=filter(data_without_NAs,variety=='Pinot Noir')
 Pinot_Noir%>%
   group_by(country)%>%
 summarize(count=n(),sumhigh=sum(above90=='High'),sumlow=sum(above90=='Low'))%>%
   arrange(desc(count))

```

```{r}
Pinot_Noir=filter(data_area,variety=='Pinot Noir')
 Pinot_Noir%>%
   group_by(Area)%>%
 summarize(count=n(),sumhigh=sum(above90=='High'),sumlow=sum(above90=='Low'))%>%
   arrange(desc(count))

```


```{r}
Popular_variety=filter(data_area,variety=='Pinot Noir'|variety=='Chardonnay'|variety=='Cabernet Sauvignon'|variety=='Red Blend'|variety=='Riesling'|variety=='Sauvignon Blanc'|variety=='Syrah'|variety=='Bordeaux-style Red Blend')
Popular_variety['Popular']='Popular'

NonPopular_variety=filter(data_area,variety!='Pinot Noir'&variety!='Chardonnay'&variety!='Cabernet Sauvignon'&variety!='Red Blend'&variety!='Riesling'&variety!='Sauvignon Blanc'&variety!='Syrah'&variety!='Bordeaux-style Red Blend')
NonPopular_variety['Popular']='NonPopular'

data_area_pop=bind_rows(Popular_variety,NonPopular_variety)
```


```{r}
mod.area <- glm(above90 ~ Popular, data = data_area_pop, family = binomial(link = "logit"))
 mod.area %>%
 summary()
```
```{r}
mod.area <- glm(above90 ~ 0+Area, data = data_area_pop, family = binomial(link = "logit"))
 mod.area %>%
 summary()
```


